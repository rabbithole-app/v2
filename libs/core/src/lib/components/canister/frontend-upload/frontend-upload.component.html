<rbth-drawer side="right">
  <ng-content />
  <rbth-drawer-content *brnSheetContent="let ctx">
    <rbth-drawer-header>
      <div rbthDrawerTitle>
        <h2>Upload frontend to canister</h2>
        <p class="text-muted-foreground text-sm font-normal">
          Select an archive with frontend to upload to user canister
        </p>
      </div>
    </rbth-drawer-header>

    <div class="flex-1 overflow-y-auto space-y-6">
      <!-- File selection zone with tabs -->
      @if (!archiveFile()) {
        <hlm-tabs tab="file" class="w-full px-4">
          <hlm-tabs-list class="grid w-full grid-cols-2">
            <button hlmTabsTrigger="file">
              <ng-icon hlm size="sm" name="lucidePackage" />
              From file
            </button>
            <button hlmTabsTrigger="github" [disabled]="true">
              <ng-icon hlm size="sm" name="lucideGithub" />
              From GitHub
            </button>
          </hlm-tabs-list>
          <div hlmTabsContent="file">
            <div
              hlmEmpty
              class="border-input hover:bg-accent/50 flex min-h-40 flex-col items-center justify-center rounded-xl border border-dashed p-8 transition-colors"
              (dragover)="$event.preventDefault()"
              (drop)="handleDrop($event)"
              role="button"
              tabindex="0"
            >
              <div hlmEmptyHeader>
                <div hlmEmptyMedia variant="icon">
                  <ng-icon [svg]="icons.fileArchive" />
                </div>
                <div hlmEmptyTitle>Select zip archive</div>
                <div hlmEmptyDescription>
                  Select a frontend archive to upload to user canister
                </div>
              </div>
              <div hlmEmptyContent>
                <div class="flex gap-2">
                  <button hlmBtn (click)="fileOpen()">
                    <ng-icon hlm size="sm" name="lucideUpload" />
                    Select file
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div hlmTabsContent="github">
            <div
              class="border-input flex min-h-40 flex-col items-center justify-center rounded-xl border border-dashed p-8 opacity-50"
            >
              <div
                class="bg-background mb-4 flex size-16 shrink-0 items-center justify-center rounded-full border"
                aria-hidden="true"
              >
                <ng-icon hlm class="opacity-60" size="lg" name="lucideGithub" />
              </div>
              <p class="mb-2 text-base font-medium">GitHub releases</p>
              <p class="text-muted-foreground mb-4 text-center text-sm">
                Select a release from GitHub repository
              </p>
              <p class="text-muted-foreground text-xs">Coming soon</p>
            </div>
          </div>
        </hlm-tabs>
      }

      <!-- Selected archive -->
      @if (archiveFile(); as archive) {
        <div
          class="mx-4 bg-muted/50 flex items-center gap-3 rounded-lg border p-4"
        >
          <div
            class="flex aspect-square size-12 shrink-0 items-center justify-center rounded border"
          >
            <ng-icon hlm class="opacity-60 size-6" [svg]="icons.fileArchive" />
          </div>
          <div class="flex-1 min-w-0">
            <p class="truncate text-sm font-medium">{{ archive.name }}</p>
            <p class="text-muted-foreground text-xs">
              {{ archive.size | formatBytes }}
            </p>
          </div>
          @if (!isProcessing()) {
            <button hlmBtn variant="ghost" size="icon-sm" (click)="onCancel()">
              <ng-icon hlm size="sm" name="lucideX" />
            </button>
          }
        </div>
      }

      <!-- Overall progress -->
      @if (isProcessing()) {
        <div class="space-y-2 px-4">
          <div class="flex items-center justify-between text-sm">
            <span class="font-medium"> Uploading files... </span>
            <span class="text-muted-foreground">
              {{ completedFiles() }} / {{ totalFiles() }} files
            </span>
          </div>
          <div hlmProgress [value]="overallProgress()" class="h-2">
            <hlm-progress-indicator />
          </div>
          <p class="text-muted-foreground text-xs">
            {{ overallProgress() | number: '1.0-0' }}% completed
          </p>
        </div>
      }

      <!-- File list -->
      @if (activeItems().length) {
        <h3 rbthDrawerSeparator>Active</h3>
        <core-upload-drawer-list [items]="activeItems()" />
      }
      @if (completedItems().length) {
        <h3 rbthDrawerSeparator>Completed</h3>
        <core-upload-drawer-list [items]="completedItems()" />
      }
      @if (failedItems().length) {
        <h3 rbthDrawerSeparator>Failed</h3>
        <core-upload-drawer-list [items]="failedItems()" />
      }
    </div>

    <!-- Install button -->
    <rbth-drawer-footer>
      <button
        hlmBtn
        [disabled]="!archiveFile() || isProcessing()"
        (click)="onInstall()"
        class="ml-auto"
      >
        @if (isProcessing()) {
          <hlm-spinner class="size-4 mr-0.5" />
        } @else {
          <ng-icon hlm size="sm" name="lucidePackage" />
        }
        {{ statusText() }}
      </button>
    </rbth-drawer-footer>
  </rbth-drawer-content>
</rbth-drawer>
