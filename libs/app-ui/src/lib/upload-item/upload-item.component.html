<div class="flex gap-3 items-center">
  @let file = data().file;
  <ng-icon hlm class="opacity-60" size="lg" [name]="file | fileIcon" />
  <div class="flex-1 space-y-1">
    <div class="text-sm/6 font-bold">{{ file.name }}</div>
    <div class="flex items-center gap-1">
      <span class="text-muted-foreground text-xs">
        @let d = data();
        @switch (d.status) {
          @case (uploadState.IN_PROGRESS) {
            {{ d.current | formatRangeBytes: d.total }}
          }
          @default {
            {{ d.file.size | formatBytes }}
          }
        }
      </span>
      <span class="text-muted-foreground text-xs">âˆ™</span>
      <ng-container [ngTemplateOutlet]="statusIcon" />
      <ng-container [ngTemplateOutlet]="statusText" />
    </div>
  </div>
  <ng-container [ngTemplateOutlet]="actionButtons" />
</div>
@if (showProgress()) {
  <brn-progress
    rbth
    class="w-full h-1.5 rounded-full"
    aria-labelledby="loading"
    [value]="progress()"
  >
    <brn-progress-indicator rbth />
  </brn-progress>
}

<ng-template #statusIcon>
  @let d = data();
  @switch (d.status) {
    @case (uploadState.FAILED) {
      <ng-icon
        [rbthTooltipTrigger]="d.errorMessage"
        hlm
        size="sm"
        name="lucideTriangleAlert"
        aria-hidden="true"
      />
    }
    @case (uploadState.COMPLETED) {
      <ng-icon hlm size="sm" name="lucideCheck" aria-hidden="true" />
    }
    @default {
      <hlm-spinner class="size-4" />
    }
  }
</ng-template>

<ng-template #statusText>
  <span class="text-xs ml-1 font-semibold">
    @let d = data();
    @switch (d.status) {
      @case (uploadState.FAILED) {
        Failed
      }
      @case (uploadState.COMPLETED) {
        Completed
      }
      @case (uploadState.NOT_STARTED) {
        Pending...
      }
      @case (uploadState.INITIALIZING) {
        Initializing...
      }
      @case (uploadState.REQUESTING_VETKD) {
        Requesting vetKeys...
      }
      @case (uploadState.FINALIZING) {
        Finalizing...
      }
      @default {
        Uploading...
      }
    }
  </span>
</ng-template>

<ng-template #actionButtons>
  @switch (data().status) {
    @case (uploadState.FAILED) {
      <ng-container [ngTemplateOutlet]="retryButton" />
      <ng-container [ngTemplateOutlet]="removeButton" />
    }
    @case (uploadState.REQUESTING_VETKD) {
      <ng-container [ngTemplateOutlet]="cancelButton" />
    }
    @case (uploadState.INITIALIZING) {
      <ng-container [ngTemplateOutlet]="cancelButton" />
    }
    @case (uploadState.IN_PROGRESS) {
      <ng-container [ngTemplateOutlet]="cancelButton" />
    }
    @case (uploadState.NOT_STARTED) {
      <ng-container [ngTemplateOutlet]="cancelButton" />
    }
    @case (uploadState.FINALIZING) {}
    @case (uploadState.COMPLETED) {
      <ng-container [ngTemplateOutlet]="removeButton" />
    }
  }
</ng-template>
<ng-template #retryButton>
  <button
    hlmBtn
    class="size-6! px-0!"
    size="icon"
    variant="ghost"
    aria-label="Retry upload"
    [rbthTooltipTrigger]="'Retry'"
    (click)="retryUpload.emit()"
  >
    <ng-icon hlm size="sm" name="lucideRotateCcw" aria-hidden="true" />
  </button>
</ng-template>
<ng-template #cancelButton>
  <button
    hlmBtn
    class="size-6! px-0!"
    size="icon"
    variant="ghost"
    [rbthTooltipTrigger]="'Cancel'"
    aria-label="Cancel upload"
    (click)="cancelUpload.emit()"
  >
    <ng-icon hlm size="sm" name="lucideX" aria-hidden="true" />
  </button>
</ng-template>
<ng-template #removeButton>
  <button
    hlmBtn
    class="size-6! px-0!"
    size="icon"
    variant="ghost"
    aria-label="Remove upload"
    [rbthTooltipTrigger]="'Remove'"
    (click)="removeUpload.emit()"
  >
    <ng-icon hlm size="sm" name="lucideTrash2" aria-hidden="true" />
  </button>
</ng-template>
