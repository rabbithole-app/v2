@if (canisterStatus(); as status) {
  <div class="space-y-6">
    <!-- Header with title, select and action buttons -->
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <h1 class="text-2xl font-semibold">Canister Management</h1>

        <div hlmButtonGroup>
          <brn-select
            class="[&>div>hlm-select-trigger>button]:rounded-r-none"
            [value]="currentCanisterId()"
            (valueChange)="_onCanisterChange($event)"
          >
            <hlm-select-trigger class="w-64">
              <hlm-select-value>
                <ng-template hlmSelectValue let-selected>
                  {{ selected || 'Select canister' }}
                </ng-template>
              </hlm-select-value>
            </hlm-select-trigger>
            <hlm-select-content>
              @for (canisterId of canisterList(); track canisterId) {
                <hlm-option [value]="canisterId">
                  {{ canisterId }}
                </hlm-option>
              }
            </hlm-select-content>
          </brn-select>
          <button
            hlmBtn
            variant="outline"
            size="icon"
            [disabled]="isLoadingStatus()"
            (click)="_refreshStatus()"
          >
            @if (isLoadingStatus()) {
              <hlm-spinner class="size-4" />
            } @else {
              <ng-icon hlm size="sm" name="lucideRefreshCw" />
            }
          </button>
        </div>
      </div>

      @if (isController()) {
        <rbth-feat-canisters-wasm-install>
          <rbth-feat-canisters-frontend-upload-drawer>
            <div hlmButtonGroup>
              <button
                hlmBtn
                variant="outline"
                rbthFeatCanistersWasmInstallTrigger
              >
                <ng-icon hlm size="sm" name="lucideBinary" />
                Install WASM
              </button>
              <button
                hlmBtn
                variant="outline"
                rbthFeatCanistersFrontendUploadTrigger
              >
                <ng-icon hlm size="sm" name="lucidePackage" />
                Install frontend
              </button>
            </div>
          </rbth-feat-canisters-frontend-upload-drawer>
        </rbth-feat-canisters-wasm-install>
      }
    </div>

    <!-- Main content -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
      <!-- Runtime Section -->
      <rbth-feat-canisters-canister-runtime
        [canister]="status"
        variant="muted"
        class="self-start"
      />

      <!-- Memory Section -->
      <rbth-feat-canisters-canister-memory
        [canister]="status"
        variant="muted"
        class="h-full"
      />

      <!-- Health Check Section -->
      <rbth-feat-canisters-canister-health-check
        [canister]="status"
        variant="muted"
        class="self-start"
      />
    </div>

    <!-- Controllers Section -->
    <div class="col-span-full">
      <rbth-feat-canisters-canister-controllers-table
        [controllers]="controllers()"
        [currentPrincipalId]="currentPrincipalId()"
        [loadingState]="loadingState()"
        (addController)="_handleAddController($event)"
        (removeController)="_handleRemoveController($event)"
      />
    </div>

    <!-- Snapshots Section -->
    <div class="col-span-full">
      <rbth-feat-canisters-canister-snapshots-table
        [snapshots]="snapshots()"
        [loadingState]="snapshotsLoadingState()"
        (takeSnapshot)="_onTakeSnapshot($event || undefined)"
        (restoreSnapshot)="_onRestoreSnapshot($event)"
        (deleteSnapshot)="_onDeleteSnapshot($event)"
        (reloadSnapshots)="_onReloadSnapshots()"
      />
    </div>
  </div>
}
