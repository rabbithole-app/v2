<rbth-drawer side="right">
  <ng-content />
  <rbth-drawer-content *brnSheetContent="let ctx">
    <rbth-drawer-header>
      <div rbthDrawerTitle>
        <h2>Upload frontend to canister</h2>
        @let showDescription = hasPermission() && !archiveFile();
        @if (showDescription) {
          <p class="text-muted-foreground text-sm font-normal">
            Select an archive with frontend to upload to user canister
          </p>
        }
      </div>
    </rbth-drawer-header>

    <div class="flex-1 overflow-y-auto space-y-6">
      @if (hasPermission()) {
        <!-- File selection zone -->
        @if (!archiveFile()) {
          <hlm-tabs tab="file" class="w-full px-4">
            <hlm-tabs-list class="grid w-full grid-cols-2">
              <button hlmTabsTrigger="file">
                <ng-icon hlm size="sm" name="lucidePackage" />
                From file
              </button>
              <button hlmTabsTrigger="github" [disabled]="true">
                <ng-icon hlm size="sm" name="lucideGithub" />
                From GitHub
              </button>
            </hlm-tabs-list>
            <div hlmTabsContent="file">
              <rbth-feat-canisters-frontend-upload-file-selection
                (fileSelect)="fileOpen()"
                (fileDrop)="onFileDropped($event)"
              />
            </div>
            <div hlmTabsContent="github">
              <rbth-feat-canisters-frontend-upload-github-selection />
            </div>
          </hlm-tabs>
        }

        <!-- Selected archive preview -->
        @if (archiveFile(); as archive) {
          <rbth-feat-canisters-frontend-upload-archive-preview
            [archive]="archive"
            [showCancel]="!isProcessing()"
            (archiveCanceled)="onCancel()"
          />
        }

        <!-- Upload progress -->
        @if (isProcessing()) {
          <rbth-feat-canisters-frontend-upload-progress
            [overallProgress]="overallProgress()"
            [completedFiles]="completedFiles()"
            [totalFiles]="totalFiles()"
          />
        }

        <!-- File list -->
        @if (activeItems().length) {
          <h3 rbthDrawerSeparator>Active</h3>
          <rbth-feat-canisters-frontend-upload-list [items]="activeItems()" />
        }
        @if (completedItems().length) {
          <h3 rbthDrawerSeparator>Completed</h3>
          <rbth-feat-canisters-frontend-upload-list
            [items]="completedItems()"
          />
        }
        @if (failedItems().length) {
          <h3 rbthDrawerSeparator>Failed</h3>
          <rbth-feat-canisters-frontend-upload-list [items]="failedItems()" />
        }
      } @else {
        <!-- Take ownership alert -->
        <div class="px-4">
          <rbth-feat-canisters-frontend-take-ownership-alert />
        </div>
      }
    </div>

    <!-- Footer -->
    <rbth-drawer-footer>
      @if (hasPermission()) {
        <button
          hlmBtn
          [disabled]="!archiveFile() || isProcessing()"
          (click)="onInstall()"
          class="ml-auto"
        >
          @if (isProcessing()) {
            <hlm-spinner class="size-4 mr-0.5" />
          } @else {
            <ng-icon hlm size="sm" name="lucidePackage" />
          }
          {{ statusText() }}
        </button>
      } @else {
        <rbth-feat-canisters-frontend-take-ownership-button
          class="ml-auto"
          (ownershipTaken)="onOwnershipTaken()"
        />
      }
    </rbth-drawer-footer>
  </rbth-drawer-content>
</rbth-drawer>
